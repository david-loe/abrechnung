FROM node:22-alpine

LABEL org.opencontainers.image.source=https://github.com/david-loe/abrechnung
LABEL org.opencontainers.image.description="abrechnungðŸ§¾ frontend DEVELOPMENT"
LABEL org.opencontainers.image.licenses=AGPL-3.0-only
# install nginx
RUN apk add nginx

COPY frontend/nginx.conf /etc/nginx/nginx.conf

WORKDIR /npm_cache
COPY frontend/package*.json ./
RUN npm install

WORKDIR /app


ENTRYPOINT [ "/bin/sh", "-c", "cp -r /npm_cache/node_modules/. /app/node_modules && exec \"$0\" \"$@\"" ]

# Run both npm and nginx in a shell
CMD [ "sh", "-c", "npm run dev & nginx -g 'daemon off;'" ]